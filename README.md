# Senflare-DNS-IP

Cloudflare优选域名DNS解析器 - 自动解析、检测和识别Cloudflare优选域名的IP状态和详情信息

## 功能特性

- 🔍 **智能DNS解析**: 支持多DNS服务器并发解析域名，获取更多IP地址
- 🌐 **运营商分流**: 支持电信、联通、移动等运营商DNS，获取最优IP
- 📡 **并发检测**: 多线程并发检测IP可用性，大幅提升检测速度
- 🌍 **地区识别**: 自动识别IP地理位置，支持缓存机制
- 📊 **智能缓存**: 支持TTL机制，减少重复查询，提升效率
- 📝 **详细日志**: 完整的运行日志，便于调试和监控
- ⚡ **高级模式**: 支持延迟测试、带宽测试、综合评分排序
- 🎯 **精准筛选**: 延迟排名前30%筛选，确保最优IP
- 📈 **性能优化**: 批量处理、连接池、智能重试机制
- ⏰ **自动运行**: GitHub Actions每3小时自动执行

## 文件说明

- `DNSIPtest.py` - 主程序脚本
- `YXhost-lite.txt` - 当前使用的域名列表（精简版）
- `YXhost.txt` - 完整域名列表（用于添加更多优选域名）
- `Cache.json` - 地区信息缓存文件
- `DNSIPlist.txt` - 可用IP列表（基础版输出）
- `SenflareDNS.txt` - 格式化结果（基础版输出）
- `DNSIPlist-Pro.txt` - 优选IP列表（高级版输出）
- `SenflareDNS-Pro.txt` - 高级格式化结果（高级版输出）
- `Ranking.txt` - 综合评分排名详情（高级版输出）

## 使用方法

### 1. 配置域名列表

编辑 `YXhost-lite.txt` 文件，每行一个域名：

```text
# Cloudflare优选域名列表
# 格式：域名#描述信息（可选）
# 每行一个域名，以#开头，用于说明

# 当前示例
orange.seeck.cn#简睿 | 三网专线 | 01
saas.sin.fan#MIYU | 三网专线
cf.877774.xyz#秋名山 | 三网专线
```

### 2. 本地运行

```bash
# 运行脚本
python DNSIPtest.py
```

**注意**：依赖包已嵌入到GitHub Actions配置中，本地运行需要安装：
- `requests>=2.31.0`
- `dnspython>=2.4.0`
- `urllib3>=2.0.0`

### 3. GitHub Actions自动运行

项目已配置GitHub Actions，每3小时自动运行一次，结果会自动提交到仓库。

## 输出格式

### 基础版输出

#### DNSIPlist.txt

```text
1.2.3.4
5.6.7.8
9.10.11.12
```

#### SenflareDNS.txt

```text
113.200.109.19#CN 中国节点 | 01
172.64.145.64#US 美国节点 | 01
104.18.41.190#US 美国节点 | 02
104.18.42.163#US 美国节点 | 03
172.64.53.24#US 美国节点 | 04
```

### 高级版输出（需要开启advanced_mode）

#### DNSIPlist-Pro.txt

```text
1.2.3.4
5.6.7.8
9.10.11.12
```

#### SenflareDNS-Pro.txt

```text
113.200.109.19#CN 中国节点 | 01
172.64.145.64#US 美国节点 | 01
104.18.41.190#US 美国节点 | 02
104.18.42.163#US 美国节点 | 03
172.64.53.24#US 美国节点 | 04
```

#### Ranking.txt

```text
📊 [1/36] 113.200.109.19（延迟 31ms，带宽 5.62Mbps，评分 74.5）
📊 [2/36] 172.64.145.64（延迟 45ms，带宽 8.12Mbps，评分 72.3）
📊 [3/36] 104.18.41.190（延迟 52ms，带宽 6.78Mbps，评分 68.9）
```

## 配置说明

### DNS服务器
- 阿里云DNS: 223.5.5.5, 223.6.6.6
- 腾讯DNS: 119.29.29.29, 182.254.116.116
- 百度DNS: 180.76.76.76
- 114 DNS: 114.114.114.114, 114.114.115.115
- 360 DNS: 101.226.4.6, 218.30.118.6
- 搜狗DNS: 123.125.81.6, 140.207.198.6
- 中国联通DNS: 123.123.123.123, 123.123.123.124

### 测试端口
- 默认测试443端口（HTTPS）
- 可在配置中修改测试端口列表

### 性能设置
- 最大并发线程数: 15
- 批量处理大小: 10
- DNS解析超时: 15秒
- 重试超时: 3秒
- 缓存TTL: 7天

### 高级模式配置
- 高级模式开关: `advanced_mode = True`
- TCP Ping测试次数: 5次
- 带宽测试次数: 3次
- 带宽测试文件大小: 1MB
- 延迟排名前百分比: 30%

## 日志说明

程序运行时会生成详细的日志信息，包括：
- 🔍 DNS解析过程（每个DNS服务器单独显示IP）
- 📡 IP可用性检测（快速筛选和TCP Ping测试）
- ⚡ 带宽测试结果（高级模式）
- 🌍 地区识别结果（支持缓存机制）
- 🎯 延迟排名筛选（高级模式）
- 📊 综合评分排序（高级模式）
- 📈 性能统计信息

## 性能测试

### 基础模式性能
- **测试结果**: 36个IP，约8秒完成
- **DNS解析成功率**: 100%（10/10个DNS服务器）
- **IP检测成功率**: 100%（36/36个IP可用）
- **地区识别**: 支持中国、美国等地区

### 高级模式性能
- **测试结果**: 36个IP，约15秒完成（包含延迟和带宽测试）
- **TCP Ping测试**: 5次测试获取准确延迟数据
- **带宽测试**: 3次测试获取带宽性能
- **综合评分**: 延迟40% + 带宽30% + 稳定性30%
- **延迟筛选**: 前30%最优IP保留

## 注意事项

1. 确保 `YXhost-lite.txt` 文件存在且包含有效的域名
2. 程序会自动创建缓存文件 `Cache.json`
3. 输出文件会在每次运行时重新生成
4. GitHub Actions需要仓库的写入权限
5. 电信和移动DNS服务器暂时注释（网络环境限制）
6. 高级模式会增加运行时间，但提供更精确的IP筛选
7. 带宽测试需要网络连接，可能受网络环境影响
8. 缓存文件会自动清理过期条目，防止文件过大

## 更新日志

### v2.1.0 (2025-10-25)
- 🎨 优化地区识别日志显示，修复日志串台问题
- 📦 完善缓存日志显示，明确区分数据来源（缓存 vs API）
- 🏀 统一地区识别结果日志格式，提升可读性
- 🔧 优化并发地区识别流程，先收集结果再统一输出
- 📝 改进日志输出顺序，确保缓存日志和地区识别结果按序显示

### v2.0.0 (2025-10-25)
- ✨ 新增高级模式，支持延迟测试、带宽测试、综合评分排序
- 🎯 新增延迟排名前30%筛选功能
- 📊 新增综合评分系统（延迟40% + 带宽30% + 稳定性30%）
- 📁 新增高级版输出文件：DNSIPlist-Pro.txt、SenflareDNS-Pro.txt、Ranking.txt
- 🔧 优化DNS解析，每个DNS服务器单独显示解析到的IP
- ⚡ 优化并发处理
- 🛠️ 优化代码结构，删除冗余代码，提升运行效率
- 📝 完善注释系统，提升代码可读性和维护性
- 🐛 修复地区识别日志顺序问题
- 🐛 修复TCP Ping测试结果重复显示问题

### v1.0.0 (2025-10-24)
- 🎉 初始版本发布
- 🔍 支持多DNS服务器并发解析
- 📡 支持IP可用性检测
- 🌍 支持地区识别和缓存
- 📝 支持详细日志记录

## 许可证

MIT License
